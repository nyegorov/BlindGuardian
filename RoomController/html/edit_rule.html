<HTML>
<HEAD>
    <TITLE>Add/Edit blind control rules</TITLE>
    <style type="text/css">
        h1 {
            font-family: segoe-ui_light, 'Segoe UI Light', 'Segoe WP', 'Helvetica Neue', Helvetica, sans-serif;
            font-weight: normal;
            color: #0066cc;
        }
        body {
            font-family: segoe-ui_normal, 'Segoe UI', Segoe, 'Segoe WP', 'Helvetica Neue', Helvetica, sans-serif;
        }
    </style>
</HEAD>
<BODY>
    <script>
        function GetURLParameter(sParam)    {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++)  {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam)    return sParameterName[1];
            }
        }
        function load_rule(id) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'rule.json?id='+id, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState != 4) return;
                if (xhr.status == 200) {
                    var rule = JSON.parse(xhr.responseText);
                    rule_name.value = rule.name;
                    condition.value = rule.condition;
                    action.value = rule.action;
                    delete_rule.value = rule.id;
                    save_rule.value = rule.id;
                }
            }
            xhr.send();
        }

        rule_id = GetURLParameter('id');
        load_rule(rule_id);

        window.onload = function () {
            if (rule_id == 0) {
                header.innerHTML = "Add rule";
                delete_rule.hidden = true;
            }
        }
        
        document.addEventListener('keyup', (event) => { if (event.keyCode == 27) history.back(); }, false);
    </script>
    <h1 id="header">Edit rule</h1>
    <form action="status" method="post" accept-charset="utf-8">
        <p>Rule name<br />
        <input id="rule_name" name="rule_name" type="text" required="required" size="80"></p>
        Condition
        <table>
            <tr>
                <td><textarea id="condition" cols="36" name="condition" rows="7"></textarea></td>
                <td style="color:green">Available sensors:<br />
                    <B>tin</B> - inner temperature<br />
                    <B>tout</B> - outer temperature<br />
                    <B>light</B> - light sensor<br />
                    <B>inactivity</B> - motion detector</td>
            </tr>
        </table>
        <br />Action
        <table>
            <tr>
                <td><textarea id="action" cols="36" name="action" rows="4"></textarea></td>
                <td style="color:green">Available actions:<br />
                    <B>open_blind</B> - open blinds<br />
                    <B>close_blind</B> - close blinds<br />
            </tr>
        </table>
        <br />
        <button id="save_rule" name="save_rule" value="rule_id" type="submit">Save</button>
        <button id="delete_rule" name="delete_rule" value="rule_id">Delete</button>
    </form>
</BODY>
</HTML>
